<dialog id="edit_profile_modal" class="modal">
  <div class="modal-box">
    <div class="error-message text-center text-error mb-4" role="alert" aria-live="polite"></div>

    {{with profile.CurrentProfile}}
    <form hx-post="{{host}}/setup" hx-target="previous .error-message" hx-swap="innerHTML" class="flex flex-col gap-4">

      <div class="flex items-center justify-between">
        <input type="hidden" name="avatar" value="{{.Avatar}}" id="avatar-input">
        <div class="avatar">
          <div class="w-12 rounded-full bg-white/10 border border-white/10 p-2">
            <img id="avatar-img" src="{{.Avatar}}" alt="Avatar">
          </div>
        </div>

        <input type="file" name="file" class="file-input" hx-encoding="multipart/form-data" hx-post="{{host}}/files"
          hx-swap="none" _="
          on htmx:beforeRequest
            add .opacity-50 to #avatar-img
          on htmx:afterRequest
            set resp to event.detail.xhr.responseText
            set #avatar-input.value to 'https://www.theskyscape.com/file/' + resp
            set #avatar-img.src to 'https://www.theskyscape.com/file/' + resp
            remove .opacity-50 from #avatar-img">
      </div>

      <label class="form-control w-full">
        <div class="label">
          <span class="label-text font-medium">Name</span>
        </div>
        <input required name="name" type="text" class="input input-bordered w-full" value="{{.Name}}">
      </label>

      <label class="form-control w-full">
        <div class="label">
          <span class="label-text font-medium">Description</span>
        </div>
        <textarea required name="description" class="textarea textarea-bordered w-full"
          rows="4">{{.Description}}</textarea>
      </label>

      <div class="form-control mt-4">
        <button type="submit" class="btn btn-primary btn-block">
          Save
        </button>
      </div>
    </form>
    {{end}}
  </div>
  <form method="dialog" class="modal-backdrop">
    <button>close</button>
  </form>
</dialog>