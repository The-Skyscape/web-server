<dialog id="promote_app_modal" class="modal">
  <div class="modal-box max-w-2xl">
    <h3 class="font-bold text-lg mb-4">Promote App</h3>

    <div class="error-message text-center text-error mb-4" role="alert" aria-live="polite"></div>

    {{with apps.CurrentApp}}
    {{$promo := .ActivePromotion}}
    {{if $promo}}
    <!-- Active promotion - show status and cancel option -->
    <div class="alert alert-success mb-4">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
      <span>This app is currently being promoted. <strong>{{$promo.DaysRemaining}} days remaining</strong>.</span>
    </div>

    {{if $promo.Content}}
    <div class="bg-base-200 rounded-lg p-4 mb-4">
      <div class="text-sm text-white/50 mb-2">Your promotion message:</div>
      <p class="text-white/80">{{$promo.Content}}</p>
    </div>
    {{end}}

    <div class="flex flex-col gap-4">
      <p class="text-white/60 text-sm">
        You can only have one active promotion at a time. Cancel the current promotion to create a new one.
      </p>

      <button hx-delete="{{host}}/apps/{{.ID}}/promote" hx-confirm="Are you sure you want to cancel this promotion?" class="btn btn-error btn-block">
        Cancel Promotion
      </button>
    </div>
    {{else}}
    <!-- No active promotion - show create form -->
    <div class="alert alert-info mb-4">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="stroke-current shrink-0 w-6 h-6"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
      <span>Your promotion will be visible to everyone for <strong>7 days</strong>.</span>
    </div>

    <form hx-post="{{host}}/apps/{{.ID}}/promote" hx-target="previous .error-message" hx-swap="innerHTML" class="flex flex-col gap-4">

      <label class="floating-label">
        <textarea name="content" class="textarea w-full" rows="4" placeholder="Share your thoughts"></textarea>
        <span>Share your thoughts</span>
      </label>

      <div class="text-sm font-medium opacity-70 mb-2">Preview</div>

      <div class="card bg-base-100 shadow-lg w-full border border-white/10">
        <div class="card-body">
          <div class="flex items-center gap-2 px-2 pb-2">
            <span class="badge badge-primary badge-sm">Promoted</span>
            {{with auth.CurrentUser}}
            <div class="avatar">
              <div class="w-5 p-0.5 bg-white/10 rounded-full border border-white/10">
                <img src="{{.Avatar}}" alt="{{.Name}}" class="rounded-full">
              </div>
            </div>

            <span class="text-sm font-semibold opacity-80">
              @{{.Handle}}
            </span>
            {{end}}
            <span class="text-xs text-white/30 ml-auto">7 days left</span>
          </div>

          <ul class="menu gap-2 w-full p-0 rounded-box border border-neutral/40">
            <li>
              <a href="{{host}}/app/{{$.ID}}" class="p-4">
                <div class="flex flex-col gap-1">
                  <div class="flex items-center">
                    {{with $.Owner}}
                    <div class="avatar">
                      <div class="w-5 p-0.5 rounded-full bg-white/10 border border-white/10 mr-1">
                        <img src="{{.Avatar}}" alt="{{.Name}}" class="rounded-full">
                      </div>
                    </div>

                    <span class="text-base font-semibold opacity-80">
                      @{{.Handle}} /&nbsp;
                    </span>
                    {{end}}

                    <span class="text-lg font-semibold">
                      {{$.Name}}
                    </span>
                  </div>

                  <span class="px-2 text-sm font-bold opacity-60">
                    {{with $.Description}}{{.}}{{else}}
                    <span class="italic opacity-80">
                      No description
                    </span>
                    {{end}}
                  </span>
                </div>

                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 320 512" height="1em" width="1em"
                  xmlns="http://www.w3.org/2000/svg" class="ml-auto">
                  <path
                    d="M285.476 272.971L91.132 467.314c-9.373 9.373-24.569 9.373-33.941 0l-22.667-22.667c-9.357-9.357-9.375-24.522-.04-33.901L188.505 256 34.484 101.255c-9.335-9.379-9.317-24.544.04-33.901l22.667-22.667c9.373-9.373 24.569-9.373 33.941 0L285.475 239.03c9.373 9.372 9.373 24.568.001 33.941z">
                  </path>
                </svg>
              </a>
            </li>
          </ul>
        </div>
      </div>

      <div class="mt-4">
        <button type="submit" class="btn btn-primary btn-block">
          Promote App
        </button>
      </div>
    </form>
    {{end}}
    {{end}}
  </div>
  <form method="dialog" class="modal-backdrop">
    <button>close</button>
  </form>
</dialog>
