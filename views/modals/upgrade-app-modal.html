{{define "upgrade-app-modal.html"}}
<dialog id="upgrade_app_modal" class="modal">
  <div class="modal-box max-w-lg">
    <form method="dialog">
      <button class="btn btn-sm btn-circle btn-ghost absolute right-2 top-2">X</button>
    </form>

    <h3 class="font-bold text-lg mb-4">Upgrade Resources</h3>

    <div class="error-message text-center text-error mb-4" role="alert" aria-live="polite"></div>

    {{with apps.CurrentApp}}
    <form method="POST" action="{{host}}/checkout/upgrade/{{.ID}}"
          x-data="{
            cpu: 1,
            storage: 5,
            get cpuPrice() { return this.cpu * 5 },
            get storagePrice() { return (this.storage * 0.25).toFixed(2) },
            get totalPrice() { return (this.cpu * 5 + this.storage * 0.25).toFixed(2) }
          }">

      <div class="space-y-6">
        <!-- CPU Slider -->
        <div class="form-control">
          <label class="label">
            <span class="label-text font-medium flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z" />
              </svg>
              CPU Cores
            </span>
            <span class="label-text-alt text-primary font-bold" x-text="'$' + cpuPrice + '/mo'"></span>
          </label>
          <input type="range" name="cpu" min="0" max="4" step="0.5" x-model="cpu" class="range range-primary range-sm" />
          <div class="flex justify-between text-xs opacity-50 px-1 mt-1">
            <span>0</span>
            <span x-text="cpu + ' cores'" class="font-medium text-primary"></span>
            <span>4</span>
          </div>
          <p class="text-xs opacity-50 mt-1">$5 per CPU core per month. Default free tier: 0.2 cores</p>
        </div>

        <!-- Storage Slider -->
        <div class="form-control">
          <label class="label">
            <span class="label-text font-medium flex items-center gap-2">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4" />
              </svg>
              Storage
            </span>
            <span class="label-text-alt text-primary font-bold" x-text="'$' + storagePrice + '/mo'"></span>
          </label>
          <input type="range" name="storage" min="0" max="100" step="1" x-model="storage" class="range range-primary range-sm" />
          <div class="flex justify-between text-xs opacity-50 px-1 mt-1">
            <span>0 GB</span>
            <span x-text="storage + ' GB'" class="font-medium text-primary"></span>
            <span>100 GB</span>
          </div>
          <p class="text-xs opacity-50 mt-1">$0.25 per GB per month. Default free tier: 1 GB</p>
        </div>
      </div>

      <!-- Total Price -->
      <div class="mt-6 p-4 bg-base-200 rounded-xl">
        <div class="flex justify-between items-center">
          <span class="font-medium">Monthly Total</span>
          <div class="text-right">
            <span class="text-2xl font-bold text-primary" x-text="'$' + totalPrice"></span>
            <span class="text-sm opacity-60">/month</span>
          </div>
        </div>
        <div class="text-xs opacity-50 mt-2 space-y-1">
          <div class="flex justify-between">
            <span>CPU (<span x-text="cpu"></span> cores)</span>
            <span x-text="'$' + cpuPrice"></span>
          </div>
          <div class="flex justify-between">
            <span>Storage (<span x-text="storage"></span> GB)</span>
            <span x-text="'$' + storagePrice"></span>
          </div>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="mt-6 flex gap-2">
        {{if payments.IsStripeConfigured}}
        <button type="submit" class="btn btn-primary flex-1" x-bind:disabled="cpu == 0 && storage == 0">
          <span x-text="'Subscribe - $' + totalPrice + '/mo'">Subscribe</span>
        </button>
        {{else}}
        <button type="button" class="btn btn-primary flex-1" disabled>
          Coming Soon
        </button>
        {{end}}
        <form method="dialog" class="contents">
          <button type="button" class="btn btn-ghost" onclick="upgrade_app_modal.close()">Cancel</button>
        </form>
      </div>

    </form>
    {{end}}
  </div>
  <form method="dialog" class="modal-backdrop">
    <button>close</button>
  </form>
</dialog>
{{end}}
