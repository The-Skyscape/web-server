{{$project := .}}
{{$user := auth.CurrentUser}}
{{$owner := $project.Owner}}
{{$isOwner := and $user $owner (eq $user.ID $owner.UserID)}}
{{$canManage := or $isOwner (and $user $user.IsAdmin)}}
{{$img := $project.ActiveImage}}

<!-- Project Navbar -->
<div class="w-full border-b border-white/10 bg-base-100/80 backdrop-blur-sm min-h-14">
  <div class="max-w-screen-xl mx-auto px-4 py-2 flex items-center gap-2 min-h-14">
    {{with $owner}}
    <a hx-boost="true" href="{{host}}/user/{{.Handle}}" class="btn btn-ghost btn-sm px-2">
      <div class="avatar">
        <div class="w-6 p-0.5 rounded-full bg-white/10 border border-white/10">
          <img src="{{.Avatar}}" alt="{{.Name}}" class="rounded-full">
        </div>
      </div>
      <span class="hidden sm:inline text-sm">@{{.Handle}}</span>
    </a>
    {{end}}

    <span class="text-sm font-bold opacity-60">/</span>
    <a href="{{host}}/project/{{$project.ID}}" hx-boost="true" class="font-semibold hover:underline">{{$project.Name}}</a>

    {{if eq $project.Status "online"}}
    <span class="badge badge-success badge-xs gap-1">
      <span class="w-1 h-1 rounded-full bg-current animate-pulse"></span>
      Online
    </span>
    {{else if eq $project.Status "launching"}}
    <span class="badge badge-warning badge-xs gap-1">
      <span class="loading loading-spinner loading-xs"></span>
      Launching
    </span>
    {{else if eq $project.Status "draft"}}
    <span class="badge badge-ghost badge-xs">Draft</span>
    {{end}}

    <div class="flex items-center gap-1 ml-auto">
      <!-- Star count -->
      {{if $user}}
      <form hx-post="{{host}}/project/{{$project.ID}}/star" hx-swap="none" class="contents">
        <button class="btn btn-ghost btn-sm gap-1 {{if $project.IsStarredBy $user.ID}}text-warning{{end}}">
          <svg class="w-4 h-4" fill="{{if $project.IsStarredBy $user.ID}}currentColor{{else}}none{{end}}" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
          <span class="text-xs">{{$project.StarsCount}}</span>
        </button>
      </form>
      {{else}}
      <div class="btn btn-ghost btn-sm gap-1">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
        </svg>
        <span class="text-xs">{{$project.StarsCount}}</span>
      </div>
      {{end}}

      <!-- Code button - links to SkyCode when logged in -->
      {{if $user}}
      <a href="https://code.skysca.pe/clone?repo=https://{{$user.Handle}}@theskyscape.com/project/{{$project.ID}}" target="_blank" class="btn btn-ghost btn-sm gap-1">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
        </svg>
        <span class="hidden sm:inline text-xs">Code</span>
      </a>
      {{end}}

      <!-- Open in new tab -->
      {{if $img}}
      <a target="_blank" href="https://{{$project.ID}}.skysca.pe" class="btn btn-ghost btn-sm gap-1">
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/>
        </svg>
        <span class="hidden sm:inline text-xs">Open</span>
      </a>
      {{end}}

      <!-- More options -->
      <div class="dropdown dropdown-end">
        <div tabindex="0" role="button" class="btn btn-ghost btn-sm">
          {{template "icon-dots.html"}}
        </div>
        <ul tabindex="-1"
          class="dropdown-content menu bg-base-100 rounded-box z-50 mt-2 w-52 p-2 shadow-lg border border-white/20">
          <li>
            <a _="on click
              call navigator.clipboard.writeText('https://www.theskyscape.com/project/{{$project.ID}}') then
              set my textContent to 'Copied!' then
              wait 2s then
              set my textContent to 'Copy Link'">
              Copy Link
            </a>
          </li>
          <li>
            <a _="on click
              call navigator.clipboard.writeText('https://www.theskyscape.com/project/{{$project.ID}}') then
              set my textContent to 'Copied!' then
              wait 2s then
              set my textContent to 'Copy Git URL'">
              Copy Git URL
            </a>
          </li>
          <li><a href="{{host}}/project/{{$project.ID}}/file/." hx-boost="true">Browse Files</a></li>
          {{if $user}}
          <li><a _="on click call share_project_modal.showModal()">Share to Feed</a></li>
          {{end}}
          {{if $canManage}}
          <div class="divider my-1"></div>
          <li><a hx-post="{{host}}/project/{{$project.ID}}/launch">{{if $img}}Relaunch{{else}}Launch{{end}}</a></li>
          <li><a href="{{host}}/project/{{$project.ID}}/manage" hx-boost="true">Manage</a></li>
          <li><a _="on click call edit_project_modal.showModal()">Edit</a></li>
          <li class="text-error"><a hx-delete="{{host}}/project/{{$project.ID}}"
              hx-confirm="Are you sure you want to shutdown this project?">Shutdown</a></li>
          {{end}}
        </ul>
      </div>
    </div>
  </div>
</div>
